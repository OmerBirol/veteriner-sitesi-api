@model List<VetRandevu.Api.Models.Pet>
@{
    ViewData["Title"] = "Pet Kartları";
    var appointments = ViewBag.Appointments as List<VetRandevu.Api.Models.Appointment> ?? new List<VetRandevu.Api.Models.Appointment>();
    var vaccinations = ViewBag.Vaccinations as List<VetRandevu.Api.Models.VaccinationRecord> ?? new List<VetRandevu.Api.Models.VaccinationRecord>();
    Layout = ViewBag.Layout ?? Layout;
    var basePath = ViewBag.BasePath as string ?? "/clinic-admin";
}

<div class="card">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <h5 class="mb-0">Pet Kartları</h5>
            <a class="btn btn-primary" href="@($"{basePath}/pets/create")">Hızlı Hasta Ekle</a>
        </div>

        @if (Model.Count == 0)
        {
            <div class="muted">Bu klinikte kayıtlı pet yok.</div>
        }
        else
        {
            foreach (var pet in Model)
            {
                var petAppointments = appointments.Where(a => a.PetId == pet.Id).ToList();
                var petVaccinations = vaccinations.Where(v => v.PetId == pet.Id).ToList();
                <div class="card mb-3">
                    <div class="card-body">
                        <h6>@pet.Name (@pet.Species) - @pet.Age</h6>
                        <div class="muted">Sahip: @pet.OwnerName @if (!string.IsNullOrWhiteSpace(pet.OwnerEmail)) { <span>• @pet.OwnerEmail</span> }</div>

                        <div class="mt-3">
                            <strong>Randevular</strong>
                            @if (petAppointments.Count == 0)
                            {
                                <div class="muted">Randevu yok.</div>
                            }
                            else
                            {
                                <ul>
                                    @foreach (var app in petAppointments)
                                    {
                                        <li>@app.StartUtc.ToLocalTime().ToString("dd.MM.yyyy HH:mm") • @app.Status</li>
                                    }
                                </ul>
                            }
                        </div>

                        <div class="mt-3">
                            <strong>Aşı Kartı</strong>
                            @if (petVaccinations.Count == 0)
                            {
                                <div class="muted">Aşı kaydı yok.</div>
                            }
                            else
                            {
                                <ul>
                                    @foreach (var record in petVaccinations)
                                    {
                                        <li>@record.VaccineName • @record.AdministeredUtc.ToLocalTime().ToString("dd.MM.yyyy") • @(record.NextDueUtc.HasValue ? record.NextDueUtc.Value.ToLocalTime().ToString("dd.MM.yyyy") : "-")</li>
                                    }
                                </ul>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>
